<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Streaming</title>
</head>
<body>
    <h1>WebRTC Streaming</h1>
    <video id="video" autoplay playsinline></video>
    <button id="start">Start Streaming</button>

    <script>
        const video = document.getElementById('video');
        const startButton = document.getElementById('start');
        let pc;

        startButton.onclick = async () => {
            pc = new RTCPeerConnection();

            pc.onicecandidate = async event => {
                if (event.candidate) {
                    await fetch('/webrtc', {
                        method: 'POST',
                        body: JSON.stringify({ candidate: event.candidate }),
                        headers: { 'Content-Type': 'application/json' }
                    });
                }
            };

            pc.ontrack = event => {
                video.srcObject = event.streams[0];
            };

            const offer = await pc.createOffer();
            await pc.setLocalDescription(offer);

            const response = await fetch('/webrtc', {
                method: 'POST',
                body: JSON.stringify({ type: 'offer', sdp: pc.localDescription }),
                headers: { 'Content-Type': 'application/json' }
            });

            const answer = await response.json();
            await pc.setRemoteDescription(new RTCSessionDescription(answer));
        };
    </script>
</body>
</html>
